<div class="email-container ">
  <div class="card wow fadeIn">
    <div class="row">
      <div class="col-xlg-3 col-lg-4 col-md-4">
        <div class="inbox-panel">
          <div
            class="d-flex p-20 no-block"
            style="    display: flex!important;
                                                                      justify-content: space-around;"
          >
            <div class="align-self-center">
              <i class="fa fa-circle text-danger m-r-5 font-10 mr-2"></i>
              <div class="font-medium mr-2">No leido</div>
              <i class="fa fa-circle text-warning m-r-5 font-10"></i>
              <div class="font-medium mr-2">Leido</div>
              <i class="fa fa-circle text-success m-r-5 font-10"></i>
              <div class="font-medium mr-2">Resuelto</div>
              <i class="fa fa-circle text-secondary m-r-5 font-10"></i>
              <div class="font-medium mr-2">Cerrado {{ rol }}</div>
            </div>
          </div>
          <div class="inb-right">
            <div class="row " *ngIf="!messages">
              <div class="col-sm-12 ">
                <div class="alert alert-warning text-center ">
                  <strong>Cargando</strong>
                  <br />
                  <i class="fa fa-sync fa-spin fa-2x "></i>
                  <br />
                  <span>Espere por favor</span>
                </div>
              </div>
            </div>
            <div
              (click)="onSelect(message, message._id, 'warning')"
              *ngFor="let message of messages; let i = index"
              [class.selected]="message === selectedMessage"
              class="list-group-item list-group-item-action border-left-0 border-right-0 flex-column animated fadeIn"
            >
              <div class="d-flex">
                <div class="">
                  <div class="avatar-status bg-{{ message.id_semaforo.color }}">
                    <!-- <img alt="" class="avatar-sm rounded-circle" [src]="message.id_cliente.id_segmento.foto" />  -->
                  </div>
                </div>
                <div class="pl-3">
                  <div
                    class="d-flex w-100 justify-content-between align-items-center"
                  >
                    <small
                      class="font-medium text-{{ message.id_semaforo.color }}"
                      style="transition: color 0.5s ease;"
                    >
                      <i class="fa fa-circle  m-r-5 font-10"></i
                      >{{ message?.id_cliente?.nombre }}
                      {{ message?.id_cliente?.apellido }}
                    </small>
                    <small class="bold text-muted time ml-2">
                      {{ message.fecha_creacion | date: "MMMM d" }}
                    </small>
                  </div>
                  <p class="mb-0 font-14 ">
                    {{ message?.id_cliente?.mensajeCliente | slice: 0:40 }} ...
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xlg-9 col-lg-8 bg-light-part b-l col-md-8 wow fadeIn">
        <div class="w-100">
          <div class="card-body" *ngIf="!rol">
            <div
              class="btn-group m-b-10 m-r-10"
              role="group"
              aria-label="Button group with nested dropdown"
            >
              <button
                (click)="whatsapp(selectedMessage.id_cliente.celular)"
                type="button"
                class="btn btn-secondary font-18"
              >
                <img
                  src="assets/images/icon/whatsapp.png"
                  alt=""
                  class="whatsapp"
                />
              </button>
              <button
                (click)="gmail(selectedMessage.id_cliente.correo)"
                type="button"
                class="btn btn-secondary font-18"
              >
                <img
                  src="assets/images/icon/gmail.png"
                  alt=""
                  class="whatsapp"
                />
              </button>
            </div>
            <div class="btn-group m-b-10 m-r-10" *ngIf="!rol">
              <button
                (click)="
                  onSelect(selectedMessage, selectedMessage._id, 'success')
                "
                class="btn btn-outline-info waves-effect waves-light"
                type="button"
              >
                <span class="btn-label"><i class="fa fa-user-circle"></i></span>
                Manejar Lead
              </button>
            </div>
          </div>
          <ng-container *ngIf="selectedMessage">
            <div class="card-body" *ngIf="rol">
              <div>
                <blockquote>
                  <form
                    [formGroup]="myForm"
                    #f="ngForm"
                    (ngSubmit)="reasignarLead(f.value)"
                  >
                    <mat-form-field>
                      <mat-label style="color: black;">Comerciales</mat-label>
                      <mat-select formControlName="comercial">
                        <ng-container *ngFor="let comercial of usuarios">
                          <mat-option [value]="comercial">
                            {{ comercial.nombre }} {{ comercial.apellido }}
                          </mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                    <button
                      [disabled]="!myForm.valid"
                      type="submit"
                      class="ml-4"
                      mat-raised-button
                    >
                      Asignar lead
                    </button>
                  </form>
                </blockquote>
              </div>
            </div>
          </ng-container>
        </div>

        <div class="card-body" *ngIf="selectedMessage">
          <div class="p-20">
            <div class="d-flex align-items-center m-b-30">
              <div class="">
                <!-- <img alt="" class="avatar-lg rounded-circle" [src]="selectedMessage.id_cliente.id_segmento.foto" />  -->
              </div>
              <div class="pl-3">
                <div class="font-medium">
                  {{ selectedMessage.id_cliente.nombre }}
                  {{ selectedMessage.id_cliente.apellido }} -
                  {{ selectedMessage.fecha_creacion | date: "MMMM d" }} (
                  <i class="icon-clock"></i>
                  {{ selectedMessage.hora_creacion }})
                </div>
                <br />
                <span class="font-14"
                  >Correo: {{ selectedMessage.id_cliente.correo }}</span
                >
                <label class="label label-{{ selectedMessage.type }}">{{
                  selectedMessage.tag
                }}</label>
              </div>
            </div>

            <div class="b-r mb-2"><strong>Mensaje del cliente:</strong></div>
            <div>
              <blockquote>
                {{ selectedMessage.id_cliente.mensajeCliente }}
              </blockquote>
            </div>
            <ng-container *ngIf="ultimoMensajeReferido != undefined">
                <div class="b-r mb-2"><strong>Mensaje del Referido:</strong></div>
                <div>
                  <blockquote>
                          {{ultimoMensajeReferido}}
                  </blockquote>
                </div>
            </ng-container>

            <ngb-tabset>
              <ngb-tab title="Perfil">
                <ng-template ngbTabContent>
                  <div class="card-body ">
                    <div class="row wow fadeInUp">
                      <div class="col-md-3 col-xs-6 b-r">
                        <strong>Nombre</strong>
                        <br />
                        <p class="text-muted">
                          {{ selectedMessage.id_cliente.nombre }}
                          {{ selectedMessage.id_cliente.apellido }}
                        </p>
                      </div>
                      <div class="col-md-3 col-xs-6 b-r">
                        <strong>Celular</strong>
                        <br />
                        <p class="text-muted">
                          {{ selectedMessage.id_cliente.celular }}
                        </p>
                      </div>
                      <div class="col-md-3 col-xs-6 b-r">
                        <strong>Correo</strong>
                        <br />
                        <p class="text-muted">
                          {{ selectedMessage.id_cliente.correo }}
                        </p>
                      </div>
                      <div class="col-md-3 col-xs-6">
                        <strong>Ciudad</strong>
                        <br />
                        <p class="text-muted">
                          {{ selectedMessage.id_cliente.id_ciudad?.nombre }}
                        </p>
                      </div>
                    </div>
                    <hr />
                  </div>
                </ng-template>
              </ngb-tab>
              <ngb-tab title="Otros">
                <ng-template ngbTabContent>
                  <div class="card-body ">
                    <div class="row wow fadeInUp">
                      <div class="col-md-3 col-xs-6 b-r">
                        <strong>Segmento</strong>
                        <br />
                        <p class="text-muted">
                          {{ selectedMessage.id_cliente.id_segmento?.nombre }}
                        </p>
                      </div>
                      <div class="col-md-3 col-xs-6 b-r">
                        <strong>Modalidad</strong>
                        <br />
                        <p class="text-muted">
                          {{ selectedMessage.id_cliente.modalidad }}
                        </p>
                      </div>
                      <div class="col-md-3 col-xs-6">
                        <strong>Tipo de Cliente</strong>
                        <br />
                        <!-- <p class="text-muted">{{selectedMessage.id_cliente.tipoCliente.nombre}}</p> -->
                      </div>
                      <div class="col-md-3 col-xs-6">
                        <strong>Fuente</strong>
                        <br />
                        <p class="text-muted">
                          {{ selectedMessage.id_cliente.fuente }}
                        </p>
                      </div>
                    </div>
                    <hr />
                  </div>
                </ng-template>
              </ngb-tab>
            </ngb-tabset>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
